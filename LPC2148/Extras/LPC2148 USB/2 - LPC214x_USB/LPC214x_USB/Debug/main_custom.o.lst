   1              		.cpu arm7tdmi-s
   2              		.fpu softvfp
   3              		.eabi_attribute 20, 1
   4              		.eabi_attribute 21, 1
   5              		.eabi_attribute 23, 3
   6              		.eabi_attribute 24, 1
   7              		.eabi_attribute 25, 1
   8              		.eabi_attribute 26, 1
   9              		.eabi_attribute 30, 6
  10              		.eabi_attribute 18, 4
  11              		.file	"main_custom.c"
  21              	.Ltext0:
  22              		.file 1 "../main_custom.c"
 3271              		.align	2
 3274              	abDescriptors:
 3275 0000 12       		.byte	18
 3276 0001 01       		.byte	1
 3277 0002 00       		.byte	0
 3278 0003 02       		.byte	2
 3279 0004 00       		.byte	0
 3280 0005 00       		.byte	0
 3281 0006 00       		.byte	0
 3282 0007 40       		.byte	64
 3283 0008 FF       		.byte	-1
 3284 0009 FF       		.byte	-1
 3285 000a 0E       		.byte	14
 3286 000b 00       		.byte	0
 3287 000c 00       		.byte	0
 3288 000d 01       		.byte	1
 3289 000e 01       		.byte	1
 3290 000f 02       		.byte	2
 3291 0010 03       		.byte	3
 3292 0011 01       		.byte	1
 3293 0012 09       		.byte	9
 3294 0013 02       		.byte	2
 3295 0014 20       		.byte	32
 3296 0015 00       		.byte	0
 3297 0016 01       		.byte	1
 3298 0017 01       		.byte	1
 3299 0018 00       		.byte	0
 3300 0019 80       		.byte	-128
 3301 001a 32       		.byte	50
 3302 001b 09       		.byte	9
 3303 001c 04       		.byte	4
 3304 001d 00       		.byte	0
 3305 001e 00       		.byte	0
 3306 001f 02       		.byte	2
 3307 0020 FF       		.byte	-1
 3308 0021 00       		.byte	0
 3309 0022 00       		.byte	0
 3310 0023 00       		.byte	0
 3311 0024 07       		.byte	7
 3312 0025 05       		.byte	5
 3313 0026 82       		.byte	-126
 3314 0027 02       		.byte	2
 3315 0028 40       		.byte	64
 3316 0029 00       		.byte	0
 3317 002a 00       		.byte	0
 3318 002b 07       		.byte	7
 3319 002c 05       		.byte	5
 3320 002d 05       		.byte	5
 3321 002e 02       		.byte	2
 3322 002f 40       		.byte	64
 3323 0030 00       		.byte	0
 3324 0031 00       		.byte	0
 3325 0032 04       		.byte	4
 3326 0033 03       		.byte	3
 3327 0034 09       		.byte	9
 3328 0035 04       		.byte	4
 3329 0036 0E       		.byte	14
 3330 0037 03       		.byte	3
 3331 0038 4C       		.byte	76
 3332 0039 00       		.byte	0
 3333 003a 50       		.byte	80
 3334 003b 00       		.byte	0
 3335 003c 43       		.byte	67
 3336 003d 00       		.byte	0
 3337 003e 55       		.byte	85
 3338 003f 00       		.byte	0
 3339 0040 53       		.byte	83
 3340 0041 00       		.byte	0
 3341 0042 42       		.byte	66
 3342 0043 00       		.byte	0
 3343 0044 1A       		.byte	26
 3344 0045 03       		.byte	3
 3345 0046 47       		.byte	71
 3346 0047 00       		.byte	0
 3347 0048 46       		.byte	70
 3348 0049 00       		.byte	0
 3349 004a 54       		.byte	84
 3350 004b 00       		.byte	0
 3351 004c 20       		.byte	32
 3352 004d 00       		.byte	0
 3353 004e 44       		.byte	68
 3354 004f 00       		.byte	0
 3355 0050 65       		.byte	101
 3356 0051 00       		.byte	0
 3357 0052 76       		.byte	118
 3358 0053 00       		.byte	0
 3359 0054 69       		.byte	105
 3360 0055 00       		.byte	0
 3361 0056 63       		.byte	99
 3362 0057 00       		.byte	0
 3363 0058 65       		.byte	101
 3364 0059 00       		.byte	0
 3365 005a 76       		.byte	118
 3366 005b 00       		.byte	0
 3367 005c 31       		.byte	49
 3368 005d 00       		.byte	0
 3369 005e 12       		.byte	18
 3370 005f 03       		.byte	3
 3371 0060 44       		.byte	68
 3372 0061 00       		.byte	0
 3373 0062 45       		.byte	69
 3374 0063 00       		.byte	0
 3375 0064 41       		.byte	65
 3376 0065 00       		.byte	0
 3377 0066 44       		.byte	68
 3378 0067 00       		.byte	0
 3379 0068 43       		.byte	67
 3380 0069 00       		.byte	0
 3381 006a 30       		.byte	48
 3382 006b 00       		.byte	0
 3383 006c 44       		.byte	68
 3384 006d 00       		.byte	0
 3385 006e 45       		.byte	69
 3386 006f 00       		.byte	0
 3387 0070 00       		.byte	0
 3388              		.bss
 3389              		.align	2
 3390              	MemoryCmd:
 3391 0000 00000000 		.space	8
 3391      00000000 
 3392              		.align	2
 3393              	abVendorReqData:
 3394 0008 00000000 		.space	8
 3394      00000000 
 3395              		.global	str
 3396              		.data
 3397              		.align	2
 3400              	str:
 3401 0000 46656C69 		.ascii	"Felipe\000"
 3401      706500
 3402              		.global	buff
 3403 0007 00       		.bss
 3404              		.align	2
 3407              	buff:
 3408 0010 00000000 		.space	50
 3408      00000000 
 3408      00000000 
 3408      00000000 
 3408      00000000 
 3409 0042 0000     		.text
 3410              		.align	2
 3412              	_HandleBulkIn:
 3413              	.LFB0:
   1:../main_custom.c **** /*
   2:../main_custom.c ****   LPCUSB, an USB device driver for LPC microcontrollers
   3:../main_custom.c ****   Copyright (C) 2006 Bertrik Sikken (bertrik@sikken.nl)
   4:../main_custom.c **** 
   5:../main_custom.c ****   Redistribution and use in source and binary forms, with or without
   6:../main_custom.c ****   modification, are permitted provided that the following conditions are met:
   7:../main_custom.c **** 
   8:../main_custom.c ****   1. Redistributions of source code must retain the above copyright
   9:../main_custom.c ****      notice, this list of conditions and the following disclaimer.
  10:../main_custom.c ****   2. Redistributions in binary form must reproduce the above copyright
  11:../main_custom.c ****      notice, this list of conditions and the following disclaimer in the
  12:../main_custom.c ****      documentation and/or other materials provided with the distribution.
  13:../main_custom.c ****   3. The name of the author may not be used to endorse or promote products
  14:../main_custom.c ****      derived from this software without specific prior written permission.
  15:../main_custom.c **** 
  16:../main_custom.c ****   THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
  17:../main_custom.c ****   IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
  18:../main_custom.c ****   OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
  19:../main_custom.c ****   IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
  20:../main_custom.c ****   INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
  21:../main_custom.c ****   NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  22:../main_custom.c ****   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  23:../main_custom.c ****   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  24:../main_custom.c ****   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  25:../main_custom.c ****   THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  26:../main_custom.c **** */
  27:../main_custom.c **** 
  28:../main_custom.c **** /*
  29:../main_custom.c ****   This is a very simple custom device (not belonging to a specific USB
  30:../main_custom.c ****   class). It implements primitive read and write in the ARM memory space.
  31:../main_custom.c **** 
  32:../main_custom.c ****   Each transfer is initiated by a control transfer to inform the device
  33:../main_custom.c ****   about the address and size of the following data transfer.
  34:../main_custom.c ****   The data transfer takes place over a bulk endpoint (BULK_IN_EP for
  35:../main_custom.c ****   reads and BULK_OUT_EP for writes).
  36:../main_custom.c **** 
  37:../main_custom.c ****   This example can be used to measure USB transfer speed.
  38:../main_custom.c **** */
  39:../main_custom.c **** 
  40:../main_custom.c **** #include <string.h>
  41:../main_custom.c **** 
  42:../main_custom.c **** #include "type.h"
  43:../main_custom.c **** #include "usbdebug.h"
  44:../main_custom.c **** 
  45:../main_custom.c **** //#include "console.h"
  46:../main_custom.c **** #include "usbapi.h"
  47:../main_custom.c **** #include "startup.h"
  48:../main_custom.c **** #include "uart.h"
  49:../main_custom.c **** #include "lpc214x.h"
  50:../main_custom.c **** #include "lcd.h"
  51:../main_custom.c **** 
  52:../main_custom.c **** 
  53:../main_custom.c **** #define BULK_IN_EP    0x82
  54:../main_custom.c **** #define BULK_OUT_EP   0x05
  55:../main_custom.c **** 
  56:../main_custom.c **** #define MAX_PACKET_SIZE 64
  57:../main_custom.c **** 
  58:../main_custom.c **** #define LE_WORD(x)    ((x)&0xFF),((x)>>8)
  59:../main_custom.c **** 
  60:../main_custom.c **** #define MAX_LENGTH 12800
  61:../main_custom.c **** 
  62:../main_custom.c **** 
  63:../main_custom.c **** static const U8 abDescriptors[] = {
  64:../main_custom.c **** 
  65:../main_custom.c **** /* Device descriptor */
  66:../main_custom.c ****   0x12,               // Size descriptor in bytes (18 bytes)
  67:../main_custom.c ****   DESC_DEVICE,        // Device descriptor
  68:../main_custom.c ****   LE_WORD(0x0200),    // bcdUSB - USB 2.0
  69:../main_custom.c ****   0x00,                 // bDeviceClass -  FIXME: 0x00 each interface specifies it's own class code
  70:../main_custom.c ****   0x00,                 // bDeviceSubClass
  71:../main_custom.c ****   0x00,                 // bDeviceProtocol
  72:../main_custom.c ****   MAX_PACKET_SIZE0,     // bMaxPacketSize
  73:../main_custom.c ****   LE_WORD(0xFFFF),    // idVendor FIXME:
  74:../main_custom.c ****   LE_WORD(0x000E),    // idProduct - antes 0x0004
  75:../main_custom.c ****   LE_WORD(0x0100),    // bcdDevice
  76:../main_custom.c ****   0x01,                 // iManufacturer
  77:../main_custom.c ****   0x02,                 // iProduct
  78:../main_custom.c ****   0x03,                 // iSerialNumber
  79:../main_custom.c ****   0x01,                 // bNumConfigurations
  80:../main_custom.c **** 
  81:../main_custom.c **** // configuration
  82:../main_custom.c ****   0x09,
  83:../main_custom.c ****   DESC_CONFIGURATION,
  84:../main_custom.c ****   LE_WORD(0x20),      // wTotalLength
  85:../main_custom.c ****   0x01,           // bNumInterfaces
  86:../main_custom.c ****   0x01,           // bConfigurationValue
  87:../main_custom.c ****   0x00,           // iConfiguration
  88:../main_custom.c ****   0x80,           // bmAttributes
  89:../main_custom.c ****   0x32,           // bMaxPower
  90:../main_custom.c **** 
  91:../main_custom.c **** // interface
  92:../main_custom.c ****   0x09,
  93:../main_custom.c ****   DESC_INTERFACE,
  94:../main_custom.c ****   0x00,           // bInterfaceNumber
  95:../main_custom.c ****   0x00,           // bAlternateSetting
  96:../main_custom.c ****   0x02,           // bNumEndPoints  FIXME: Antes 0x02
  97:../main_custom.c ****   0xFF,           // bInterfaceClass - antes 0xFF
  98:../main_custom.c ****   0x00,           // bInterfaceSubClass
  99:../main_custom.c ****   0x00,           // bInterfaceProtocol
 100:../main_custom.c ****   0x00,           // iInterface
 101:../main_custom.c **** 
 102:../main_custom.c **** // bulk in
 103:../main_custom.c ****   0x07,
 104:../main_custom.c ****   DESC_ENDPOINT,
 105:../main_custom.c ****   BULK_IN_EP,       // bEndpointAddress
 106:../main_custom.c ****   0x02,           // bmAttributes = BULK
 107:../main_custom.c ****   LE_WORD(MAX_PACKET_SIZE),// wMaxPacketSize
 108:../main_custom.c ****   0,            // bInterval
 109:../main_custom.c **** 
 110:../main_custom.c **** // bulk out
 111:../main_custom.c ****   0x07,
 112:../main_custom.c ****   DESC_ENDPOINT,
 113:../main_custom.c ****   BULK_OUT_EP,      // bEndpointAddress
 114:../main_custom.c ****   0x02,           // bmAttributes = BULK
 115:../main_custom.c ****   LE_WORD(MAX_PACKET_SIZE),// wMaxPacketSize
 116:../main_custom.c ****   0,            // bInterval
 117:../main_custom.c **** 
 118:../main_custom.c **** // string descriptors
 119:../main_custom.c ****   0x04,
 120:../main_custom.c ****   DESC_STRING,
 121:../main_custom.c ****   LE_WORD(0x0409),
 122:../main_custom.c **** 
 123:../main_custom.c ****   // manufacturer string
 124:../main_custom.c ****   0x0E,
 125:../main_custom.c ****   DESC_STRING,
 126:../main_custom.c ****   'L', 0, 'P', 0, 'C', 0, 'U', 0, 'S', 0, 'B', 0,
 127:../main_custom.c **** 
 128:../main_custom.c ****   // product string
 129:../main_custom.c ****   0x1A,
 130:../main_custom.c ****   DESC_STRING,
 131:../main_custom.c ****   'G', 0, 'F', 0, 'T', 0, ' ', 0, 'D', 0, 'e', 0, 'v', 0, 'i', 0, 'c', 0, 'e', 0, 'v', 0, '1', 0,
 132:../main_custom.c **** 
 133:../main_custom.c ****   // serial number string
 134:../main_custom.c ****   0x12,
 135:../main_custom.c ****   DESC_STRING,
 136:../main_custom.c ****   'D', 0, 'E', 0, 'A', 0, 'D', 0, 'C', 0, '0', 0, 'D', 0, 'E', 0,
 137:../main_custom.c **** 
 138:../main_custom.c ****   // terminator
 139:../main_custom.c ****   0
 140:../main_custom.c **** };
 141:../main_custom.c **** 
 142:../main_custom.c **** 
 143:../main_custom.c **** typedef struct {
 144:../main_custom.c ****   U32   dwAddress;
 145:../main_custom.c ****   U32   dwLength;
 146:../main_custom.c **** } TMemoryCmd;
 147:../main_custom.c **** 
 148:../main_custom.c **** 
 149:../main_custom.c **** static TMemoryCmd MemoryCmd;
 150:../main_custom.c **** static U8     abVendorReqData[sizeof(TMemoryCmd)];
 151:../main_custom.c **** U8 str[] = "Felipe";
 152:../main_custom.c **** U8 buff[50] = {0};
 153:../main_custom.c **** 
 154:../main_custom.c **** static void _HandleBulkIn(U8 bEP, U8 bEPStatus)
 155:../main_custom.c **** {
 3414              		.loc 1 155 0
 3415              		.cfi_startproc
 3416              		@ Function supports interworking.
 3417              		@ args = 0, pretend = 0, frame = 8
 3418              		@ frame_needed = 1, uses_anonymous_args = 0
 3419 0000 00482DE9 		stmfd	sp!, {fp, lr}
 3420              	.LCFI0:
 3421              		.cfi_def_cfa_offset 8
 3422 0004 04B08DE2 		add	fp, sp, #4
 3423              		.cfi_offset 14, -4
 3424              		.cfi_offset 11, -8
 3425              	.LCFI1:
 3426              		.cfi_def_cfa 11, 4
 3427 0008 08D04DE2 		sub	sp, sp, #8
 3428 000c 0020A0E1 		mov	r2, r0
 3429 0010 0130A0E1 		mov	r3, r1
 3430 0014 05204BE5 		strb	r2, [fp, #-5]
 3431 0018 06304BE5 		strb	r3, [fp, #-6]
 156:../main_custom.c **** 
 157:../main_custom.c ****   USBHwEPWrite(bEP, str, sizeof(str));
 3432              		.loc 1 157 0
 3433 001c 05305BE5 		ldrb	r3, [fp, #-5]	@ zero_extendqisi2
 3434 0020 0300A0E1 		mov	r0, r3
 3435 0024 10109FE5 		ldr	r1, .L2
 3436 0028 0720A0E3 		mov	r2, #7
 3437 002c FEFFFFEB 		bl	USBHwEPWrite
 158:../main_custom.c **** 
 159:../main_custom.c **** }
 3438              		.loc 1 159 0
 3439 0030 04D04BE2 		sub	sp, fp, #4
 3440 0034 0048BDE8 		ldmfd	sp!, {fp, lr}
 3441 0038 1EFF2FE1 		bx	lr
 3442              	.L3:
 3443              		.align	2
 3444              	.L2:
 3445 003c 00000000 		.word	str
 3446              		.cfi_endproc
 3447              	.LFE0:
 3449              		.align	2
 3451              	_HandleBulkOut:
 3452              	.LFB1:
 160:../main_custom.c **** 
 161:../main_custom.c **** 
 162:../main_custom.c **** static void _HandleBulkOut(U8 bEP, U8 bEPStatus)
 163:../main_custom.c **** {
 3453              		.loc 1 163 0
 3454              		.cfi_startproc
 3455              		@ Function supports interworking.
 3456              		@ args = 0, pretend = 0, frame = 16
 3457              		@ frame_needed = 1, uses_anonymous_args = 0
 3458 0040 00482DE9 		stmfd	sp!, {fp, lr}
 3459              	.LCFI2:
 3460              		.cfi_def_cfa_offset 8
 3461 0044 04B08DE2 		add	fp, sp, #4
 3462              		.cfi_offset 14, -4
 3463              		.cfi_offset 11, -8
 3464              	.LCFI3:
 3465              		.cfi_def_cfa 11, 4
 3466 0048 10D04DE2 		sub	sp, sp, #16
 3467 004c 0020A0E1 		mov	r2, r0
 3468 0050 0130A0E1 		mov	r3, r1
 3469 0054 0D204BE5 		strb	r2, [fp, #-13]
 3470 0058 0E304BE5 		strb	r3, [fp, #-14]
 164:../main_custom.c ****   int x = 0;
 3471              		.loc 1 164 0
 3472 005c 0030A0E3 		mov	r3, #0
 3473 0060 08300BE5 		str	r3, [fp, #-8]
 165:../main_custom.c **** 
 166:../main_custom.c ****   x = USBHwEPRead(bEP,buff,sizeof(buff));
 3474              		.loc 1 166 0
 3475 0064 0D305BE5 		ldrb	r3, [fp, #-13]	@ zero_extendqisi2
 3476 0068 0300A0E1 		mov	r0, r3
 3477 006c 14109FE5 		ldr	r1, .L5
 3478 0070 3220A0E3 		mov	r2, #50
 3479 0074 FEFFFFEB 		bl	USBHwEPRead
 3480 0078 08000BE5 		str	r0, [fp, #-8]
 167:../main_custom.c **** 
 168:../main_custom.c **** 
 169:../main_custom.c **** }
 3481              		.loc 1 169 0
 3482 007c 04D04BE2 		sub	sp, fp, #4
 3483 0080 0048BDE8 		ldmfd	sp!, {fp, lr}
 3484 0084 1EFF2FE1 		bx	lr
 3485              	.L6:
 3486              		.align	2
 3487              	.L5:
 3488 0088 00000000 		.word	buff
 3489              		.cfi_endproc
 3490              	.LFE1:
 3492              		.section	.rodata
 3493 0071 000000   		.align	2
 3494              	.LC0:
 3495 0074 0D0A2D44 		.ascii	"\015\012-D- READ: addr=%X, len=%d\012\000"
 3495      2D205245 
 3495      41443A20 
 3495      61646472 
 3495      3D25582C 
 3496 0091 000000   		.align	2
 3497              	.LC1:
 3498 0094 0D0A2D44 		.ascii	"\015\012-D- WRITE: addr=%X, len=%d\012\000"
 3498      2D205752 
 3498      4954453A 
 3498      20616464 
 3498      723D2558 
 3499 00b2 0000     		.align	2
 3500              	.LC2:
 3501 00b4 0D0A2D44 		.ascii	"\015\012-D- Unhandled class %X\012\000"
 3501      2D20556E 
 3501      68616E64 
 3501      6C656420 
 3501      636C6173 
 3502              		.text
 3503              		.align	2
 3505              	HandleVendorRequest:
 3506              	.LFB2:
 170:../main_custom.c **** 
 171:../main_custom.c **** 
 172:../main_custom.c **** /*************************************************************************
 173:../main_custom.c ****   HandleVendorRequest
 174:../main_custom.c ****   ===================
 175:../main_custom.c ****     Handles vendor specific requests
 176:../main_custom.c **** 
 177:../main_custom.c ****   Control transfer fields:
 178:../main_custom.c ****   * request:  0x01 = prepare memory read
 179:../main_custom.c ****         0x02 = prepare memory write
 180:../main_custom.c ****   * index:  ignored
 181:../main_custom.c ****   * value:  ignored
 182:../main_custom.c ****   * data:   U32 dwAddress
 183:../main_custom.c ****         U32 dwLength
 184:../main_custom.c **** 
 185:../main_custom.c **** **************************************************************************/
 186:../main_custom.c **** static BOOL HandleVendorRequest(TSetupPacket *pSetup, int *piLen, U8 **ppbData)
 187:../main_custom.c **** {
 3507              		.loc 1 187 0
 3508              		.cfi_startproc
 3509              		@ Function supports interworking.
 3510              		@ args = 0, pretend = 0, frame = 24
 3511              		@ frame_needed = 1, uses_anonymous_args = 0
 3512 008c 00482DE9 		stmfd	sp!, {fp, lr}
 3513              	.LCFI4:
 3514              		.cfi_def_cfa_offset 8
 3515 0090 04B08DE2 		add	fp, sp, #4
 3516              		.cfi_offset 14, -4
 3517              		.cfi_offset 11, -8
 3518              	.LCFI5:
 3519              		.cfi_def_cfa 11, 4
 3520 0094 18D04DE2 		sub	sp, sp, #24
 3521 0098 10000BE5 		str	r0, [fp, #-16]
 3522 009c 14100BE5 		str	r1, [fp, #-20]
 3523 00a0 18200BE5 		str	r2, [fp, #-24]
 188:../main_custom.c ****   TMemoryCmd  *pCmd;
 189:../main_custom.c **** 
 190:../main_custom.c ****   pCmd = (TMemoryCmd *)*ppbData;
 3524              		.loc 1 190 0
 3525 00a4 18301BE5 		ldr	r3, [fp, #-24]
 3526 00a8 003093E5 		ldr	r3, [r3, #0]
 3527 00ac 08300BE5 		str	r3, [fp, #-8]
 191:../main_custom.c **** 
 192:../main_custom.c ****   switch (pSetup->bRequest) {
 3528              		.loc 1 192 0
 3529 00b0 10301BE5 		ldr	r3, [fp, #-16]
 3530 00b4 0130D3E5 		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 3531 00b8 010053E3 		cmp	r3, #1
 3532 00bc 0200000A 		beq	.L9
 3533 00c0 020053E3 		cmp	r3, #2
 3534 00c4 1300000A 		beq	.L10
 3535 00c8 220000EA 		b	.L13
 3536              	.L9:
 193:../main_custom.c **** 
 194:../main_custom.c ****   // prepare read
 195:../main_custom.c ****   case 0x01:
 196:../main_custom.c ****     MemoryCmd = *pCmd;
 3537              		.loc 1 196 0
 3538 00cc B4309FE5 		ldr	r3, .L14
 3539 00d0 08201BE5 		ldr	r2, [fp, #-8]
 3540 00d4 030092E8 		ldmia	r2, {r0, r1}
 3541 00d8 030083E8 		stmia	r3, {r0, r1}
 197:../main_custom.c ****     TRACE_DEBUG("READ: addr=%X, len=%d\n", MemoryCmd.dwAddress, MemoryCmd.dwLength);
 3542              		.loc 1 197 0
 3543 00dc A4309FE5 		ldr	r3, .L14
 3544 00e0 002093E5 		ldr	r2, [r3, #0]
 3545 00e4 9C309FE5 		ldr	r3, .L14
 3546 00e8 043093E5 		ldr	r3, [r3, #4]
 3547 00ec 98009FE5 		ldr	r0, .L14+4
 3548 00f0 0210A0E1 		mov	r1, r2
 3549 00f4 0320A0E1 		mov	r2, r3
 3550 00f8 FEFFFFEB 		bl	iprintf
 198:../main_custom.c ****     // send initial packet
 199:../main_custom.c ****     _HandleBulkIn(BULK_IN_EP, 0);
 3551              		.loc 1 199 0
 3552 00fc 8200A0E3 		mov	r0, #130
 3553 0100 0010A0E3 		mov	r1, #0
 3554 0104 BDFFFFEB 		bl	_HandleBulkIn
 200:../main_custom.c ****     *piLen = 0;
 3555              		.loc 1 200 0
 3556 0108 14301BE5 		ldr	r3, [fp, #-20]
 3557 010c 0020A0E3 		mov	r2, #0
 3558 0110 002083E5 		str	r2, [r3, #0]
 201:../main_custom.c ****     break;
 3559              		.loc 1 201 0
 3560 0114 160000EA 		b	.L11
 3561              	.L10:
 202:../main_custom.c **** 
 203:../main_custom.c ****   // prepare write
 204:../main_custom.c ****   case 0x02:
 205:../main_custom.c ****     MemoryCmd = *pCmd;
 3562              		.loc 1 205 0
 3563 0118 68309FE5 		ldr	r3, .L14
 3564 011c 08201BE5 		ldr	r2, [fp, #-8]
 3565 0120 030092E8 		ldmia	r2, {r0, r1}
 3566 0124 030083E8 		stmia	r3, {r0, r1}
 206:../main_custom.c ****     TRACE_DEBUG("WRITE: addr=%X, len=%d\n", MemoryCmd.dwAddress, MemoryCmd.dwLength);
 3567              		.loc 1 206 0
 3568 0128 58309FE5 		ldr	r3, .L14
 3569 012c 002093E5 		ldr	r2, [r3, #0]
 3570 0130 50309FE5 		ldr	r3, .L14
 3571 0134 043093E5 		ldr	r3, [r3, #4]
 3572 0138 50009FE5 		ldr	r0, .L14+8
 3573 013c 0210A0E1 		mov	r1, r2
 3574 0140 0320A0E1 		mov	r2, r3
 3575 0144 FEFFFFEB 		bl	iprintf
 207:../main_custom.c ****     *piLen = 0;
 3576              		.loc 1 207 0
 3577 0148 14301BE5 		ldr	r3, [fp, #-20]
 3578 014c 0020A0E3 		mov	r2, #0
 3579 0150 002083E5 		str	r2, [r3, #0]
 208:../main_custom.c ****     break;
 3580              		.loc 1 208 0
 3581 0154 060000EA 		b	.L11
 3582              	.L13:
 209:../main_custom.c **** 
 210:../main_custom.c ****   default:
 211:../main_custom.c ****     TRACE_DEBUG("Unhandled class %X\n", pSetup->bRequest);
 3583              		.loc 1 211 0
 3584 0158 10301BE5 		ldr	r3, [fp, #-16]
 3585 015c 0130D3E5 		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 3586 0160 2C009FE5 		ldr	r0, .L14+12
 3587 0164 0310A0E1 		mov	r1, r3
 3588 0168 FEFFFFEB 		bl	iprintf
 212:../main_custom.c ****     return FALSE;
 3589              		.loc 1 212 0
 3590 016c 0030A0E3 		mov	r3, #0
 3591 0170 000000EA 		b	.L12
 3592              	.L11:
 213:../main_custom.c ****   }
 214:../main_custom.c ****   return TRUE;
 3593              		.loc 1 214 0
 3594 0174 0130A0E3 		mov	r3, #1
 3595              	.L12:
 215:../main_custom.c **** }
 3596              		.loc 1 215 0
 3597 0178 0300A0E1 		mov	r0, r3
 3598 017c 04D04BE2 		sub	sp, fp, #4
 3599 0180 0048BDE8 		ldmfd	sp!, {fp, lr}
 3600 0184 1EFF2FE1 		bx	lr
 3601              	.L15:
 3602              		.align	2
 3603              	.L14:
 3604 0188 00000000 		.word	MemoryCmd
 3605 018c 74000000 		.word	.LC0
 3606 0190 94000000 		.word	.LC1
 3607 0194 B4000000 		.word	.LC2
 3608              		.cfi_endproc
 3609              	.LFE2:
 3611              		.section	.rodata
 3612 00ce 0000     		.align	2
 3613              	.LC3:
 3614 00d0 0D0A2D44 		.ascii	"\015\012-D- Initialising USB stack\012\000"
 3614      2D20496E 
 3614      69746961 
 3614      6C697369 
 3614      6E672055 
 3615 00ee 0000     		.align	2
 3616              	.LC4:
 3617 00f0 0D0A2D44 		.ascii	"\015\012-D- Starting USB communication\012\000"
 3617      2D205374 
 3617      61727469 
 3617      6E672055 
 3617      53422063 
 3618 0112 0000     		.text
 3619              		.align	2
 3620              		.global	main
 3622              	main:
 3623              	.LFB3:
 216:../main_custom.c **** 
 217:../main_custom.c **** 
 218:../main_custom.c **** 
 219:../main_custom.c **** 
 220:../main_custom.c **** #define BAUD_RATE 9600
 221:../main_custom.c **** 
 222:../main_custom.c **** 
 223:../main_custom.c **** /*************************************************************************
 224:../main_custom.c ****   main
 225:../main_custom.c ****   ====
 226:../main_custom.c **** **************************************************************************/
 227:../main_custom.c **** 
 228:../main_custom.c **** int main(void)
 229:../main_custom.c **** {
 3624              		.loc 1 229 0
 3625              		.cfi_startproc
 3626              		@ Function supports interworking.
 3627              		@ args = 0, pretend = 0, frame = 0
 3628              		@ frame_needed = 1, uses_anonymous_args = 0
 3629 0198 00482DE9 		stmfd	sp!, {fp, lr}
 3630              	.LCFI6:
 3631              		.cfi_def_cfa_offset 8
 3632 019c 04B08DE2 		add	fp, sp, #4
 3633              		.cfi_offset 14, -4
 3634              		.cfi_offset 11, -8
 3635              	.LCFI7:
 3636              		.cfi_def_cfa 11, 4
 230:../main_custom.c ****   // PLL and MAM
 231:../main_custom.c **** //  int res = 0;
 232:../main_custom.c **** //  uint32_t i = 0;
 233:../main_custom.c **** //  U8 buff[] = "Felipe" ;
 234:../main_custom.c **** 
 235:../main_custom.c **** 
 236:../main_custom.c ****   Initialize();
 3637              		.loc 1 236 0
 3638 01a0 FEFFFFEB 		bl	Initialize
 237:../main_custom.c ****   IODIR1 |= (1 << 17);
 3639              		.loc 1 237 0
 3640 01a4 C0309FE5 		ldr	r3, .L18
 3641 01a8 BC209FE5 		ldr	r2, .L18
 3642 01ac 002092E5 		ldr	r2, [r2, #0]
 3643 01b0 022882E3 		orr	r2, r2, #131072
 3644 01b4 002083E5 		str	r2, [r3, #0]
 238:../main_custom.c **** //  IOCLR1 = 1 << 17;
 239:../main_custom.c ****   IOSET1 = (1 << 17);
 3645              		.loc 1 239 0
 3646 01b8 B0309FE5 		ldr	r3, .L18+4
 3647 01bc 0228A0E3 		mov	r2, #131072
 3648 01c0 002083E5 		str	r2, [r3, #0]
 240:../main_custom.c **** 
 241:../main_custom.c ****   // init DBG
 242:../main_custom.c **** //  ConsoleInit(60000000 / (16 * BAUD_RATE));
 243:../main_custom.c ****   UART_Init(0,BAUD_RATE);
 3649              		.loc 1 243 0
 3650 01c4 0000A0E3 		mov	r0, #0
 3651 01c8 961DA0E3 		mov	r1, #9600
 3652 01cc FEFFFFEB 		bl	UART_Init
 244:../main_custom.c **** //  Inicializar_LCD();
 245:../main_custom.c **** 
 246:../main_custom.c ****   TRACE_DEBUG("Initialising USB stack\n");
 3653              		.loc 1 246 0
 3654 01d0 9C009FE5 		ldr	r0, .L18+8
 3655 01d4 FEFFFFEB 		bl	iprintf
 247:../main_custom.c **** //  lcd_string("FELIPE");
 248:../main_custom.c ****   // initialise stack
 249:../main_custom.c ****   USBInit();
 3656              		.loc 1 249 0
 3657 01d8 FEFFFFEB 		bl	USBInit
 250:../main_custom.c **** 
 251:../main_custom.c ****   // register device descriptors
 252:../main_custom.c ****   USBRegisterDescriptors(abDescriptors);
 3658              		.loc 1 252 0
 3659 01dc 94009FE5 		ldr	r0, .L18+12
 3660 01e0 FEFFFFEB 		bl	USBRegisterDescriptors
 253:../main_custom.c **** 
 254:../main_custom.c ****   // override standard request handler
 255:../main_custom.c ****   USBRegisterRequestHandler(REQTYPE_TYPE_VENDOR, HandleVendorRequest, abVendorReqData);
 3661              		.loc 1 255 0
 3662 01e4 0200A0E3 		mov	r0, #2
 3663 01e8 8C109FE5 		ldr	r1, .L18+16
 3664 01ec 8C209FE5 		ldr	r2, .L18+20
 3665 01f0 FEFFFFEB 		bl	USBRegisterRequestHandler
 256:../main_custom.c **** 
 257:../main_custom.c ****   // register endpoints
 258:../main_custom.c ****   USBHwRegisterEPIntHandler(BULK_IN_EP, _HandleBulkIn);
 3666              		.loc 1 258 0
 3667 01f4 8200A0E3 		mov	r0, #130
 3668 01f8 84109FE5 		ldr	r1, .L18+24
 3669 01fc FEFFFFEB 		bl	USBHwRegisterEPIntHandler
 259:../main_custom.c ****   USBHwRegisterEPIntHandler(BULK_OUT_EP, _HandleBulkOut);
 3670              		.loc 1 259 0
 3671 0200 0500A0E3 		mov	r0, #5
 3672 0204 7C109FE5 		ldr	r1, .L18+28
 3673 0208 FEFFFFEB 		bl	USBHwRegisterEPIntHandler
 260:../main_custom.c **** 
 261:../main_custom.c ****   TRACE_DEBUG("Starting USB communication\n");
 3674              		.loc 1 261 0
 3675 020c 78009FE5 		ldr	r0, .L18+32
 3676 0210 FEFFFFEB 		bl	iprintf
 262:../main_custom.c **** 
 263:../main_custom.c ****   // connect to bus
 264:../main_custom.c ****   USBHwConnect(TRUE);
 3677              		.loc 1 264 0
 3678 0214 0100A0E3 		mov	r0, #1
 3679 0218 FEFFFFEB 		bl	USBHwConnect
 265:../main_custom.c **** 
 266:../main_custom.c **** 
 267:../main_custom.c **** //  res = USBHwEPWrite(BULK_OUT_EP,buff,sizeof(buff));
 268:../main_custom.c **** //  res = USBHwEPWrite(BULK_OUT_EP,buff,sizeof(buff));
 269:../main_custom.c **** //  res = USBHwEPWrite(BULK_OUT_EP,buff,sizeof(buff));
 270:../main_custom.c **** //  res = USBHwEPWrite(BULK_OUT_EP,buff,sizeof(buff));
 271:../main_custom.c **** //
 272:../main_custom.c **** //  if(res != TRUE)
 273:../main_custom.c **** //    TRACE_DEBUG("No write EP")
 274:../main_custom.c **** //  else
 275:../main_custom.c **** //    TRACE_DEBUG("Write bulk")
 276:../main_custom.c ****   // call USB interrupt handler continuously
 277:../main_custom.c **** 
 278:../main_custom.c ****   T0PR = 30;          //incrementa o contador, quando o contador prescale atinge o valor de PR.
 3680              		.loc 1 278 0
 3681 021c 6C309FE5 		ldr	r3, .L18+36
 3682 0220 1E20A0E3 		mov	r2, #30
 3683 0224 002083E5 		str	r2, [r3, #0]
 279:../main_custom.c ****   T0TCR = 0x00000002; //desabilita o contador e reseta o
 3684              		.loc 1 279 0
 3685 0228 64309FE5 		ldr	r3, .L18+40
 3686 022c 0220A0E3 		mov	r2, #2
 3687 0230 002083E5 		str	r2, [r3, #0]
 280:../main_custom.c ****   T0MCR = 0x00000003; //On match reset the counter and generate an interrupt
 3688              		.loc 1 280 0
 3689 0234 5C309FE5 		ldr	r3, .L18+44
 3690 0238 0320A0E3 		mov	r2, #3
 3691 023c 002083E5 		str	r2, [r3, #0]
 281:../main_custom.c ****   T0MR0 = 0xFFFFFFFF;      // T0MR0 = Match Register 0,
 3692              		.loc 1 281 0
 3693 0240 54309FE5 		ldr	r3, .L18+48
 3694 0244 0020E0E3 		mvn	r2, #0
 3695 0248 002083E5 		str	r2, [r3, #0]
 282:../main_custom.c ****                 // Tempo = (CLOCK dos periféricos (PCLK) / Prescaler (T0PR)) *  Match Register (T0M
 283:../main_custom.c ****                 // Tempo = (PCLK/T0PR) * T0MR0, Ex: Tempo = (30 MHz/30) * 1000000 = 1us
 284:../main_custom.c **** 
 285:../main_custom.c ****   T0MR1   = 0x00000000; // Set duty cycle to zero
 3696              		.loc 1 285 0
 3697 024c 4C309FE5 		ldr	r3, .L18+52
 3698 0250 0020A0E3 		mov	r2, #0
 3699 0254 002083E5 		str	r2, [r3, #0]
 286:../main_custom.c ****   T0TCR     = 0x00000001; //enable timer
 3700              		.loc 1 286 0
 3701 0258 34309FE5 		ldr	r3, .L18+40
 3702 025c 0120A0E3 		mov	r2, #1
 3703 0260 002083E5 		str	r2, [r3, #0]
 3704              	.L17:
 287:../main_custom.c **** 
 288:../main_custom.c **** //  VICVectAddr4 = (unsigned)T0isr;   //Set the timer ISR vector address
 289:../main_custom.c **** //  VICVectCntl4 = 0x00000024;      //Set channel
 290:../main_custom.c **** //  VICIntSelect &= ~(1<<4);      //seleciona a se a interrupção sera FIQ ou IRQ para o timmer0
 291:../main_custom.c **** //  VICIntEnable |= 0x00000010;     //habilita a interrupção de timer 0
 292:../main_custom.c **** //  enableIRQ(); // habilita que havera a utilização de interrupção
 293:../main_custom.c **** 
 294:../main_custom.c **** 
 295:../main_custom.c ****   while (1) {
 296:../main_custom.c **** 
 297:../main_custom.c ****     USBHwISR();
 3705              		.loc 1 297 0 discriminator 1
 3706 0264 FEFFFFEB 		bl	USBHwISR
 298:../main_custom.c **** //    if(T0TC >= 10000000)
 299:../main_custom.c **** //    {
 300:../main_custom.c **** //      T0TC = 0;
 301:../main_custom.c **** ////      USBHwISR();
 302:../main_custom.c **** //    }
 303:../main_custom.c **** 
 304:../main_custom.c **** 
 305:../main_custom.c **** 
 306:../main_custom.c **** 
 307:../main_custom.c **** 
 308:../main_custom.c **** 
 309:../main_custom.c **** 
 310:../main_custom.c **** 
 311:../main_custom.c **** 
 312:../main_custom.c **** //    if(i >= 30000)
 313:../main_custom.c **** //    {
 314:../main_custom.c **** //      res = USBHwEPWrite(BULK_OUT_EP,buff,sizeof(buff));
 315:../main_custom.c **** //     if(res != TRUE)
 316:../main_custom.c **** //       TRACE_DEBUG("No write EP")
 317:../main_custom.c **** //     else
 318:../main_custom.c **** //       TRACE_DEBUG("Write bulk")
 319:../main_custom.c **** //
 320:../main_custom.c **** //       i = 0;
 321:../main_custom.c **** //    }
 322:../main_custom.c **** //
 323:../main_custom.c **** //       i++;
 324:../main_custom.c ****   }
 3707              		.loc 1 324 0 discriminator 1
 3708 0268 FDFFFFEA 		b	.L17
 3709              	.L19:
 3710              		.align	2
 3711              	.L18:
 3712 026c 188002E0 		.word	-536707048
 3713 0270 148002E0 		.word	-536707052
 3714 0274 D0000000 		.word	.LC3
 3715 0278 00000000 		.word	abDescriptors
 3716 027c 00000000 		.word	HandleVendorRequest
 3717 0280 08000000 		.word	abVendorReqData
 3718 0284 00000000 		.word	_HandleBulkIn
 3719 0288 00000000 		.word	_HandleBulkOut
 3720 028c F0000000 		.word	.LC4
 3721 0290 0C4000E0 		.word	-536854516
 3722 0294 044000E0 		.word	-536854524
 3723 0298 144000E0 		.word	-536854508
 3724 029c 184000E0 		.word	-536854504
 3725 02a0 1C4000E0 		.word	-536854500
 3726              		.cfi_endproc
 3727              	.LFE3:
 3729              	.Letext0:
DEFINED SYMBOLS
                            *ABS*:00000000 main_custom.c
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3271   .rodata:00000000 $d
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3274   .rodata:00000000 abDescriptors
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3389   .bss:00000000 $d
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3390   .bss:00000000 MemoryCmd
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3393   .bss:00000008 abVendorReqData
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3400   .data:00000000 str
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3397   .data:00000000 $d
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3407   .bss:00000010 buff
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3410   .text:00000000 $a
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3412   .text:00000000 _HandleBulkIn
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3445   .text:0000003c $d
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3449   .text:00000040 $a
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3451   .text:00000040 _HandleBulkOut
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3488   .text:00000088 $d
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3503   .text:0000008c $a
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3505   .text:0000008c HandleVendorRequest
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3604   .text:00000188 $d
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3619   .text:00000198 $a
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3622   .text:00000198 main
C:\Users\FELIPE\AppData\Local\Temp\ccjMUesa.s:3712   .text:0000026c $d
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
USBHwEPWrite
USBHwEPRead
iprintf
Initialize
UART_Init
USBInit
USBRegisterDescriptors
USBRegisterRequestHandler
USBHwRegisterEPIntHandler
USBHwConnect
USBHwISR
